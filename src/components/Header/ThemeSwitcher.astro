---
import { getLangFromUrl, useTranslations } from "@i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<label class="swap swap-flip text-3xl leading-none">
	<input id="theme-toggle" type="checkbox" />

	<div class="swap-on" title={t("theme.light")}>☀️</div>
	<div class="swap-off" title={t("theme.dark")}>🌚</div>
</label>

<script is:inline>
	const toggle = document.querySelector("#theme-toggle");

	const systemTheme = window.matchMedia("(prefers-color-scheme: dark)").matches
		? "dark"
		: "light";

	let currentTheme = localStorage.getItem("data-theme") || systemTheme;
	toggle.checked = currentTheme === "light";
	document.documentElement.setAttribute("data-theme", currentTheme);

	toggle.addEventListener("change", () => {
		currentTheme = toggle.checked ? "light" : "dark";
		document.documentElement.setAttribute("data-theme", currentTheme);
		localStorage.setItem("data-theme", currentTheme);
	});

	window
		.matchMedia("(prefers-color-scheme: dark)")
		.addEventListener("change", (e) => {
			if (localStorage.getItem("data-theme")) return;

			currentTheme = e.matches ? "dark" : "light";
			toggle.checked = currentTheme === "light";
			document.documentElement.setAttribute("data-theme", currentTheme);
		});
</script>
